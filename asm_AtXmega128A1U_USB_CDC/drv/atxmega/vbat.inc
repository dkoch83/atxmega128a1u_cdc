;/*
;* vbat.inc
;*
;*  Created: 21.02.2015 02:21:01
;*   Author: Dominik
;*/ 

.IFNDEF VBAT_INCLUDE
.SET VBAT_INCLUDE = 1

.IFNDEF VBAT_BASE
	.EQU VBAT_BASE = 0x00F0
.ENDIF
.IFNDEF CPU_BASE
	.EQU CPU_BASE = 0x0030
.ENDIF


VBAT_RESET:
PUSH R16
	LDI R16, 0xD8
	STS CPU_BASE+0x04, R16
	LDI R16, 0b00000001
	STS VBAT_BASE, R16
POP R16
RET

VBAT_ACCEN:
PUSH R16
	LDI R16, (1<<1)
	STS VBAT_BASE, R16
POP R16
RET

VBAT_XOSCFDEN:
PUSH R16
	LDI R16, (1<<2)
	STS VBAT_BASE, R16
POP R16
RET

VBAT_XOSCEN:
PUSH R16
	LDI R16, (1<<3)
	STS VBAT_BASE, R16
POP R16
RET

VBAT_XOSCSEL:
PUSH R16
	LDI R16, (1<<4)
	STS VBAT_BASE, R16
POP R16
RET

VBAT_WAIT_XOSCRDY:
PUSH R16
	VBAT_WAIT_XOSCRDY_LOOP:
		LDS R16, VBAT_BASE+1
		SBRS R16, 3
	RJMP VBAT_WAIT_XOSCRDY_LOOP
POP R16
RET

.ENDIF